apiVersion: v1
kind: ConfigMap
metadata:
  name: jupyterhub-config
  namespace: development
data:
  jupyterhub_config.py: |
    c = get_config()
    
    # Hub configuration
    c.JupyterHub.ip = '0.0.0.0'
    c.JupyterHub.port = 8000
    c.JupyterHub.hub_ip = '0.0.0.0'
    c.JupyterHub.hub_port = 8081
    
    # Use simple local spawner (spawns notebooks in same container)
    c.JupyterHub.spawner_class = 'jupyterhub.spawner.SimpleLocalProcessSpawner'
    
    # Spawn timeouts - critical for Raspberry Pi with limited resources
    c.Spawner.start_timeout = 120  # Allow 2 minutes for server to start
    c.Spawner.http_timeout = 60    # HTTP request timeout
    c.Spawner.poll_interval = 30   # How often to poll the spawner
    
    # Simple authenticator - any username with password 'jupyter'
    c.JupyterHub.authenticator_class = 'jupyterhub.auth.DummyAuthenticator'
    c.DummyAuthenticator.password = 'jupyter'
    
    # Admin users
    c.Authenticator.admin_users = {'admin'}
    
    # Database - use SQLite (simpler)
    c.JupyterHub.db_url = 'sqlite:///jupyterhub.sqlite'
    
    # Allow any username
    c.Authenticator.allowed_users = set()
    c.Authenticator.allow_all = True
    
    # Notebook directory
    c.Spawner.notebook_dir = '/home/jovyan'
    
    # Environment variables for MLflow integration
    c.Spawner.environment = {
        'MLFLOW_TRACKING_URI': 'http://mlflow.ml-platform.svc.cluster.local:5000',
    }
